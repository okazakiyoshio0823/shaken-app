<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechaniq - ãƒ¡ã‚«ãƒ‹ãƒ¼ã‚¯ | è»Šæ¤œè¦‹ç©ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* å°åˆ·/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼èª¿æ•´ãƒ¢ãƒ¼ãƒ‰ */
        /* ã‚„ã‚„è©°ã‚ã‚‹ (Compact) */
        .print-compact {
            font-size: 0.9em !important;
        }

        .print-compact .preview-table th,
        .print-compact .preview-table td {
            padding: 4px 6px !important;
        }

        .print-compact .preview-section {
            margin: 10px 0 5px !important;
            padding: 4px 8px !important;
            font-size: 1.1em !important;
        }

        .print-compact .preview-info-item {
            margin-bottom: 2px !important;
        }

        .print-compact .preview-title {
            font-size: 1.4em !important;
            margin-bottom: 10px !important;
        }

        /* ã‹ãªã‚Šè©°ã‚ã‚‹ (Eco) */
        .print-eco {
            font-size: 0.8em !important;
        }

        .print-eco .preview-table th,
        .print-eco .preview-table td {
            padding: 2px 4px !important;
        }

        .print-eco .preview-section {
            margin: 5px 0 5px !important;
            padding: 2px 8px !important;
            font-size: 1em !important;
        }

        .print-eco .preview-info-item {
            margin-bottom: 0px !important;
        }

        .print-eco .preview-title {
            font-size: 1.2em !important;
            margin-bottom: 5px !important;
        }

        /* é™ç•Œã¾ã§è©°ã‚ã‚‹ (Super Compact) */
        .print-super-compact {
            font-size: 0.75em !important;
        }

        .print-super-compact .preview-table th,
        .print-super-compact .preview-table td {
            padding: 1px 3px !important;
            line-height: 1.1 !important;
        }

        .print-super-compact .preview-section {
            margin: 3px 0 3px !important;
            padding: 1px 6px !important;
            font-size: 0.95em !important;
        }

        .print-super-compact .preview-info-item {
            margin-bottom: 0px !important;
        }

        .print-super-compact .preview-title {
            font-size: 1.1em !important;
            margin-bottom: 3px !important;
        }

        /* ç´„æ¬¾ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé€šå¸¸ã¯éè¡¨ç¤ºã€JSã§åˆ¶å¾¡ï¼‰ */
        #printTerms {
            display: none;
            margin-top: 20px;
            page-break-before: auto;
            /* å¿…è¦ã«å¿œã˜ã¦JSã§åˆ¶å¾¡ */
        }

        #printTerms h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            text-align: center;
        }

        #printTerms .terms-content {
            font-size: 0.8em;
            color: #555;
            line-height: 1.4;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }


        /* å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
        @media print {
            @page {
                margin: 0;
                size: A4 portrait;
            }

            body {
                margin: 0;
                padding: 0;
                background-color: white;
                -webkit-print-color-adjust: exact;
            }

            /* å…¨ã¦ã®UIã¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä¸€æ—¦éè¡¨ç¤ºã«ã™ã‚‹ */
            .app-container,
            .container,
            .no-print,
            .modal-overlay,
            .modal,
            h1,
            .input-group,
            .action-buttons,
            #historyContainer,
            .tab-buttons,
            .section-title {
                display: none !important;
            }

            /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã¨ãã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã ã‘ã‚’å°åˆ·å¯¾è±¡ã«ã™ã‚‹ */
            #previewModal {
                display: block !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
                z-index: auto !important;
            }

            /* å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é ˜åŸŸã®è¡¨ç¤º */
            #printPreview {
                display: block !important;
                max-width: 1000px;
                margin: 0 auto;
                background-color: white;
            }

            /* å›ºå®šãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ (å®Œå…¨ã«794px = A4 ãƒ”ã‚¯ã‚»ãƒ«å›ºå®š) */
            .print-page {
                width: 794px;
                height: 1123px;
                margin: 0 auto;
                background: #fff;
                page-break-after: always;
                position: relative;
                /* å°åˆ·æ™‚ã®å†…éƒ¨ä½™ç™½ï¼ˆãƒ•ãƒƒã‚¿ãƒ¼ç”¨ãªã©ã®éš™é–“ã‚’ç¢ºä¿ï¼‰ */
                padding: 40px;
                box-sizing: border-box;
                overflow: hidden;
            }

            .print-page:last-child {
                page-break-after: auto;
            }

            /* ãƒšãƒ¼ã‚¸å†…ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª¿æ•´ */
            .print-page .header-section {
                display: flex;
                justify-content: space-between;
                align-items: flex-end;
                margin-bottom: 20px;
                border-bottom: 2px solid #333;
                padding-bottom: 10px;
            }

            .print-page .page-title {
                font-size: 2em;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
            }

            .print-page .customer-vehicle-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-top: 20px;
            }

            .print-page .info-box {
                border: 1px solid #ccc;
                padding: 15px;
                border-radius: 4px;
            }

            .print-page .info-box h3 {
                margin-top: 0;
                border-bottom: 1px solid #ccc;
                padding-bottom: 5px;
                font-size: 1.1em;
            }

            /* ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è¡Œ */
            .maintenance-row {
                height: 40px;
                /* è¡Œã®é«˜ã•ã‚’å›ºå®š */
                border-bottom: 1px solid #ccc;
            }

            .maintenance-row td {
                padding: 0 8px;
                vertical-align: middle;
            }

            /* ç´„æ¬¾ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ€çµ‚ãƒšãƒ¼ã‚¸ç”¨ï¼‰ */
            .terms-section {
                clear: both;
                margin-top: 30px;
                border: 2px solid #555;
                padding: 20px;
                font-size: 0.85em;
                background-color: #fff;
            }

            /* ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®å¼·åˆ¶ä¸Šæ›¸ããƒªã‚»ãƒƒãƒˆï¼ˆå¿µã®ãŸã‚ï¼‰ */
            body>#previewModal {
                display: block !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
            }

            html,
            body {
                height: auto !important;
                overflow: visible !important;
            }

            /* 4. ãƒ¢ãƒ¼ãƒ€ãƒ«å†…éƒ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒªã‚»ãƒƒãƒˆ */
            #previewModal .modal-content {
                display: block !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                max-width: none !important;
                max-height: none !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: visible !important;
            }

            /* .modal-body ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šã‚’è§£é™¤ï¼ˆã“ã‚ŒãŒç™½ç´™ã®åŸå› ï¼‰ */
            #previewModal .modal-body {
                display: block !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                max-height: none !important;
                overflow: visible !important;
                margin: 0 !important;
                padding: 0 !important;
                flex: none !important;
            }

            /* 5. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡ã®è¡¨ç¤º */
            #previewContent {
                display: block !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* 6. å°åˆ·ç”¨ã‚³ãƒ³ãƒ†ãƒŠã®ä½™ç™½èª¿æ•´ */
            .print-preview {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã«ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã®ä½™ç™½è¨­å®šã«å§”ã­ã‚‹ã€ã‚ã‚‹ã„ã¯æœ€å°é™ã«ã™ã‚‹ */
                border: none !important;
                box-shadow: none !important;
                min-height: 0 !important;
                /* style.cssã®min-heightã‚’æ‰“ã¡æ¶ˆã— */
            }

            /* ä¸è¦ãªUIéè¡¨ç¤º */
            .modal-header,
            .modal-footer,
            .modal-close {
                display: none !important;
            }

            /* ãƒ•ã‚©ãƒ³ãƒˆèª¿æ•´ */
            body {
                font-size: 10pt;
                /* å°‘ã—å°ã•ãã—ã¦åã¾ã‚Šã‚’è‰¯ãã™ã‚‹ */
            }

            /* æ”¹ãƒšãƒ¼ã‚¸åˆ¶å¾¡ */
            .print-preview {
                page-break-inside: auto;
            }

            table {
                page-break-inside: auto;
                margin-bottom: 20px;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            thead {
                display: table-header-group;
            }

            tfoot {
                display: table-footer-group;
            }

            /* ç©ºç™½ãƒšãƒ¼ã‚¸å¯¾ç­– */
            * {
                float: none !important;
            }

            /* æ”¹ãƒšãƒ¼ã‚¸åˆ†æ–­é˜²æ­¢ç”¨ã‚¯ãƒ©ã‚¹ */
            .avoid-break {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
        }
    </style>
</head>

<body>
    <!-- èªè¨¼ãƒã‚§ãƒƒã‚¯ -->
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
        (function () {
            const token = localStorage.getItem('authToken');
            if (!token) {
                // ãƒˆãƒ¼ã‚¯ãƒ³ãŒãªã„å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = 'login.html';
            }
        })();
    </script>

    <div class="app-container">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h1>ğŸ”§ Mechaniq - ãƒ¡ã‚«ãƒ‹ãƒ¼ã‚¯</h1>
                <p>è»Šæ¤œè¦‹ç©ã‚’ã‚¹ãƒãƒ¼ãƒˆã«ä½œæˆ</p>
            </div>
            <div>
                <button type="button" class="btn btn-sm btn-outline"
                    style="color:white; border-color:white; background:transparent;"
                    onclick="window.shakenApi.logout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
        </header>

        <div class="toolbar">
            <button type="button" class="btn btn-outline" onclick="clearForm()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
            <button type="button" class="btn btn-info" onclick="showEstimateHistoryModal()">ğŸ“Š å±¥æ­´</button>
            <button type="button" class="btn btn-secondary" onclick="showTemplateModal()">ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
            <button type="button" class="btn btn-success" onclick="saveEstimateToHistory()">ğŸ’¾ è¦‹ç©ã‚’ä¿å­˜</button>
            <button type="button" class="btn btn-success" onclick="showJsonImportModal()">ğŸ“¥ è»Šæ¤œè¨¼JSON</button>
            <select class="form-control" id="documentType" title="æ›¸é¡ç¨®åˆ¥">
                <option value="estimate">ğŸ“ è¦‹ç©æ›¸</option>
                <option value="invoice">ğŸ“„ è«‹æ±‚æ›¸</option>
                <option value="receipt">ğŸ§¾ é ˜åæ›¸</option>
            </select>
            <button type="button" class="btn btn-primary" onclick="showPreview()">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
        </div>


        <!-- ä¼šç¤¾æƒ…å ± -->
        <div class="card">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
                <span>ğŸ¢ ä¼šç¤¾æƒ…å ±</span>
                <button type="button" class="btn btn-sm btn-outline"
                    style="color:white;border-color:white;padding:4px 8px;" onclick="showThemeSettingsModal()">ğŸ¨
                    ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š</button>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>ä¼šç¤¾å</label>
                        <input type="text" class="form-control" id="companyName" value="ã‚µãƒ³ãƒ—ãƒ«è‡ªå‹•è»Šæ•´å‚™"
                            style="ime-mode: active;">
                    </div>
                    <div class="form-group">
                        <label>é›»è©±ç•ªå·</label>
                        <input type="tel" class="form-control" id="companyTel" value="03-1234-5678">
                    </div>
                </div>
                <div class="form-group">
                    <label>ä½æ‰€</label>
                    <input type="text" class="form-control" id="companyAddress" value="ã€’123-4567 æ±äº¬éƒ½â—‹â—‹åŒºâ—‹â—‹ç”º1-2-3"
                        style="ime-mode: active;">
                </div>
            </div>
        </div>

        <!-- ãŠå®¢æ§˜æƒ…å ± -->
        <div class="card">
            <div class="card-header">ğŸ‘¤ ãŠå®¢æ§˜æƒ…å ±ï¼ˆè»Šæ¤œè¨¼æƒ…å ±ï¼‰</div>
            <div class="card-body">
                <div class="customer-buttons">
                    <button type="button" class="btn btn-primary" onclick="showCustomerListModal()">ğŸ“‚
                        ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿è¾¼ã¿</button>
                    <button type="button" class="btn btn-success" onclick="saveCustomerData()">ğŸ’¾ ã“ã®ãŠå®¢æ§˜ã‚’ä¿å­˜</button>
                </div>
                <div class="customer-buttons" style="margin-top:8px;">
                    <button type="button" class="btn btn-outline" onclick="exportCustomersToFile()">ğŸ“¥
                        ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ(ï¾…ï¾ï¾Šï¾ï½°ï¾Œï¾Ÿï¾šï½°ï¾„æ‰“è¾¼ã¿å¿…é ˆ)</button>
                    <button type="button" class="btn btn-outline" onclick="importCustomersFromFile()">ğŸ“¤
                        ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                </div>

                <!-- ä½¿ç”¨è€…æƒ…å ±ï¼ˆè»Šæ¤œè¨¼ï¼šä½¿ç”¨è€…æ¬„ï¼‰ -->
                <div class="section-divider"
                    style="margin:16px 0 12px;padding:8px 12px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:8px;">
                    <strong style="color:#1565c0;">ğŸš— ä½¿ç”¨è€…ï¼ˆè»Šæ¤œè¨¼ï¼šä½¿ç”¨è€…æ¬„ï¼‰</strong>
                    <span style="font-size:0.85em;color:#666;margin-left:8px;">â€»é€šå¸¸ã¯ã“ã¡ã‚‰ã«è»Šæ¤œã®è«‹æ±‚å…ˆã‚’å…¥åŠ›</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä½¿ç”¨è€…æ°å/åç§° <span class="required">*</span></label>
                        <input type="text" class="form-control" id="userName" placeholder="å±±ç”° å¤ªéƒ"
                            style="ime-mode: active;">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ãƒªã‚¬ãƒŠ</label>
                        <input type="text" class="form-control" id="userNameKana" placeholder="ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦"
                            style="ime-mode: active;">
                    </div>
                </div>
                <div class="form-group">
                    <label>ä½¿ç”¨è€…ä½æ‰€</label>
                    <input type="text" class="form-control" id="userAddress" placeholder="ã€’000-0000 â—‹â—‹çœŒâ—‹â—‹å¸‚..."
                        style="ime-mode: active;">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>é›»è©±ç•ªå·</label>
                        <input type="tel" class="form-control" id="userTel" placeholder="000-0000-0000">
                    </div>
                    <div class="form-group">
                        <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                        <input type="email" class="form-control" id="userEmail" placeholder="example@email.com">
                    </div>
                </div>

                <!-- æ‰€æœ‰è€…æƒ…å ±ï¼ˆè»Šæ¤œè¨¼ï¼šæ‰€æœ‰è€…æ¬„ï¼‰ -->
                <div class="section-divider"
                    style="margin:16px 0 12px;padding:8px 12px;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-radius:8px;">
                    <strong style="color:#e65100;">ğŸ“‹ æ‰€æœ‰è€…ï¼ˆè»Šæ¤œè¨¼ï¼šæ‰€æœ‰è€…æ¬„ï¼‰</strong>
                    <span style="font-size:0.85em;color:#666;margin-left:8px;">â€»ãƒ­ãƒ¼ãƒ³ãƒ»ãƒªãƒ¼ã‚¹æ™‚ã¯ä¿¡è²©ä¼šç¤¾ç­‰</span>
                    <label style="margin-left:12px;font-size:0.9em;"><input type="checkbox" id="ownerSameAsUser"
                            onchange="toggleOwnerSameAsUser()" style="margin-right:4px;">ä½¿ç”¨è€…ã¨åŒã˜</label>
                </div>
                <div id="ownerFields">
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ‰€æœ‰è€…æ°å/åç§°</label>
                            <input type="text" class="form-control" id="ownerName" placeholder="â—‹â—‹ãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚¹æ ªå¼ä¼šç¤¾"
                                style="ime-mode: active;">
                        </div>
                        <div class="form-group">
                            <label>æ‰€æœ‰è€…ä½æ‰€</label>
                            <input type="text" class="form-control" id="ownerAddress" placeholder="ã€’000-0000 â—‹â—‹çœŒâ—‹â—‹å¸‚..."
                                style="ime-mode: active;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è»Šä¸¡æƒ…å ± -->
        <div class="card">
            <div class="card-header">ğŸš™ è»Šä¸¡æƒ…å ±</div>
            <div class="card-body">
                <div class="qr-scan-buttons" style="margin-bottom:16px;display:flex;gap:8px;flex-wrap:wrap;">
                    <button type="button" class="btn btn-primary" onclick="showQRScannerModal()"
                        style="background:linear-gradient(135deg,#4CAF50,#45a049);">ğŸ“· è»Šæ¤œè¨¼QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
                    <button type="button" class="btn btn-outline" onclick="importVehicleCertificateJSON()">ğŸ“„
                        é›»å­è»Šæ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿</button>
                </div>
                <div class="form-group">
                    <label>ãƒŠãƒ³ãƒãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ <span class="required">*</span></label>
                    <div class="plate-input">
                        <div class="plate-input">
                            <input type="text" class="form-control" id="plateRegion" placeholder="å“å·"
                                style="ime-mode: active;">
                            <input type="tel" class="form-control" id="plateClass" placeholder="500"
                                style="ime-mode: disabled;" inputmode="numeric">
                            <input type="text" class="form-control" id="plateHiragana" placeholder="ã‚"
                                style="ime-mode: active;">
                            <span>-</span>
                            <input type="tel" class="form-control" id="plateSerial" placeholder="1234"
                                style="ime-mode: disabled;" inputmode="numeric">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ãƒ¡ãƒ¼ã‚«ãƒ¼</label>
                        <select class="form-control" id="carMaker" onchange="onMakerChange()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è»Šå</label>
                        <select class="form-control" id="carNameSelect" onchange="onCarNameChange()">
                            <option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å…ˆã«é¸æŠ</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å‹å¼</label>
                        <select class="form-control" id="carModelSelect" onchange="onModelChange()">
                            <option value="">è»Šåã‚’å…ˆã«é¸æŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å‹å¼ï¼ˆæ‰‹å…¥åŠ›ï¼‰</label>
                        <input type="text" class="form-control" id="carModel" placeholder="ä¸Šè¨˜ã«ãªã„å ´åˆã¯ç›´æ¥å…¥åŠ›">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å‹å¼æŒ‡å®šç•ªå·</label>
                        <input type="tel" class="form-control" id="typeDesignationNumber" placeholder="12345"
                            inputmode="numeric">
                    </div>
                    <div class="form-group">
                        <label>é¡åˆ¥åŒºåˆ†ç•ªå·</label>
                        <input type="tel" class="form-control" id="categoryClassificationNumber" placeholder="0001"
                            inputmode="numeric">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è»Šåï¼ˆè¡¨ç¤ºç”¨ï¼‰</label>
                        <input type="text" class="form-control" id="carName" placeholder="ãƒˆãƒ¨ã‚¿ ãƒ—ãƒªã‚¦ã‚¹">
                    </div>
                    <div class="form-group">
                        <label>è»Šå°ç•ªå·</label>
                        <input type="text" class="form-control" id="chassisNumber" placeholder="ZVW50-1234567">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>
                            åˆåº¦ç™»éŒ²å¹´æœˆæ—¥
                            <div class="date-input-toggle"
                                style="display:inline-flex;background:#f0f0f0;border-radius:20px;padding:2px;margin-left:8px;">
                                <button type="button" class="date-toggle-btn active" data-mode="seireki"
                                    onclick="toggleDateInputMode('firstRegistration', 'seireki')"
                                    style="padding:4px 12px;border:none;background:#4CAF50;color:white;border-radius:18px;cursor:pointer;transition:all 0.3s;">è¥¿æš¦</button>
                                <button type="button" class="date-toggle-btn" data-mode="wareki"
                                    onclick="toggleDateInputMode('firstRegistration', 'wareki')"
                                    style="padding:4px 12px;border:none;background:transparent;border-radius:18px;cursor:pointer;transition:all 0.3s;">å’Œæš¦</button>
                            </div>
                        </label>
                        <!-- è¥¿æš¦å…¥åŠ› -->
                        <input type="date" class="form-control seireki-input" id="firstRegistration"
                            onchange="onSeirekiChange('firstRegistration')">
                        <!-- å’Œæš¦å…¥åŠ› -->
                        <div class="wareki-input" id="firstRegistrationWareki"
                            style="display:none;gap:8px;align-items:center;margin-top:8px;">
                            <select class="form-control" id="firstRegistrationEra"
                                onchange="onWarekiChange('firstRegistration')" style="width:80px;padding:6px;">
                                <option value="ä»¤å’Œ">ä»¤å’Œ</option>
                                <option value="å¹³æˆ">å¹³æˆ</option>
                                <option value="æ˜­å’Œ">æ˜­å’Œ</option>
                            </select>
                            <input type="number" class="form-control" id="firstRegistrationYear" min="1" max="99"
                                placeholder="å…ƒ" onchange="onWarekiChange('firstRegistration')"
                                style="width:60px;padding:6px;">
                            <span>å¹´</span>
                            <select class="form-control" id="firstRegistrationMonth"
                                onchange="onWarekiChange('firstRegistration')" style="width:70px;padding:6px;">
                                <option value="">æœˆ</option>
                            </select>
                            <span>æœˆ</span>
                            <select class="form-control" id="firstRegistrationDay"
                                onchange="onWarekiChange('firstRegistration')" style="width:70px;padding:6px;">
                                <option value="">æ—¥</option>
                            </select>
                            <span>æ—¥</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>èµ°è¡Œè·é›¢</label>
                        <div class="input-with-unit">
                            <input type="number" class="form-control" id="mileage" placeholder="50000">
                            <span>km</span>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è»Šæ¤œåŒºåˆ†</label>
                        <select class="form-control" id="shakenType" onchange="updateShakenType()">
                            <option value="none">è»Šæ¤œãªã—ï¼ˆä¸€èˆ¬æ•´å‚™ï¼‰</option>
                            <option value="new">æ–°è»Šï¼ˆåˆå›3å¹´ï¼‰</option>
                            <option value="continue" selected>ç¶™ç¶šè»Šæ¤œï¼ˆ2å¹´ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è»Šæ¤œæº€äº†æ—¥ï¼ˆç›´æ¥å…¥åŠ›ï¼‰</label>
                        <input type="date" class="form-control" id="shakenExpiryDate"
                            onchange="updateShakenExpiryDisplay()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="width:100%;">
                        <div class="shaken-expiry-display" id="shakenExpiryDisplay"
                            style="padding:12px;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border-radius:8px;text-align:center;font-weight:bold;color:#2e7d32;">
                            è»Šæ¤œæº€äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è»Šä¸¡é‡é‡ <span class="required">*</span></label>
                        <select class="form-control" id="vehicleWeight" onchange="updateLegalFees()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="kei">è»½è‡ªå‹•è»Š</option>
                            <option value="500">500kgä»¥ä¸‹</option>
                            <option value="1000">501ã€œ1,000kg</option>
                            <option value="1500">1,001ã€œ1,500kg</option>
                            <option value="2000">1,501ã€œ2,000kg</option>
                            <option value="2500">2,001ã€œ2,500kg</option>
                            <option value="3000">2,501ã€œ3,000kg</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è»Šä¸¡çµŒéå¹´æ•° <span class="required">*</span></label>
                        <select class="form-control" id="vehicleAge" onchange="updateLegalFees()">
                            <option value="normal">13å¹´æœªæº€</option>
                            <option value="ecocar">ã‚¨ã‚³ã‚«ãƒ¼æ¸›ç¨å¯¾è±¡</option>
                            <option value="over13">13å¹´è¶…</option>
                            <option value="over18">18å¹´è¶…</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å·¥å ´åŒºåˆ†</label>
                        <select class="form-control" id="factoryType" onchange="updateLegalFees()">
                            <option value="designated">æŒ‡å®šå·¥å ´</option>
                            <option value="certified">èªè¨¼å·¥å ´ï¼ˆæŒã¡è¾¼ã¿ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>OSSç”³è«‹</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="useOSS" onchange="updateLegalFees()" checked>
                            <label for="useOSS">OSSï¼ˆãƒ¯ãƒ³ã‚¹ãƒˆãƒƒãƒ—ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ•´å‚™å†…å®¹ -->
        <div class="card">
            <div class="card-header">ğŸ”§ æ•´å‚™å†…å®¹</div>
            <div class="card-body">
                <table class="estimate-table" id="maintenanceTable">
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th class="text-center">æ•°é‡</th>
                            <th class="text-right" style="width: 250px;">å˜ä¾¡</th>
                            <th class="text-right">é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceItems"></tbody>
                </table>
                <style>
                    .btn-add-sub {
                        width: 30px;
                        height: 30px;
                        border: none;
                        border-radius: 50%;
                        background-color: #007bff;
                        /* Blue */
                        color: white;
                        font-size: 18px;
                        cursor: pointer;
                        line-height: 1;
                        margin-right: 5px;
                        transition: background-color 0.2s;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        padding-bottom: 2px;
                    }

                    .btn-add-sub:hover {
                        background-color: #0056b3;
                    }

                    .stacked-input {
                        margin-bottom: 4px;
                    }

                    .stacked-input:last-child {
                        margin-bottom: 0;
                    }
                </style>
                <div class="add-item-row"
                    style="display: grid; grid-template-columns: 2fr 0.6fr 1.5fr 0.8fr; gap: 8px; align-items: center;">
                    <input type="text" class="form-control" id="newItemName" placeholder="é …ç›®åã‚’å…¥åŠ›">
                    <input type="number" class="form-control qty" id="newItemQty" value="1" min="1">
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <div style="display: flex; align-items: center; justify-content: flex-end;">
                            <span style="font-size: 0.8em; color: #666; margin-right: 5px;">éƒ¨å“</span>
                            <input type="number" class="form-control price" id="newItemParts" placeholder="0" min="0"
                                style="width: 100px;">
                        </div>
                        <div style="display: flex; align-items: center; justify-content: flex-end;">
                            <span style="font-size: 0.8em; color: #666; margin-right: 5px;">é‰±æ²¹é¡</span>
                            <input type="number" class="form-control price" id="newItemFluid" placeholder="0" min="0"
                                style="width: 100px;">
                        </div>
                        <div style="display: flex; align-items: center; justify-content: flex-end;">
                            <span style="font-size: 0.8em; color: #666; margin-right: 5px;">å·¥è³ƒ</span>
                            <input type="number" class="form-control price" id="newItemWage" placeholder="0" min="0"
                                style="width: 100px;">
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="addMaintenanceItem()">â• è¿½åŠ </button>
                </div>

                <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤å¼•ãè¨­å®š -->
                <div
                    style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #fff9e6, #fff3d9); border-radius: 8px; border: 1px solid #ffe082;">
                    <div style="font-weight: bold; margin-bottom: 8px; color: #f57c00;">ğŸ’° å…¨ä½“ä¸€æ‹¬å€¤å¼•ãè¨­å®š</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9em;">
                        <div>
                            <label style="display: block; font-size: 0.85em; color: #666; margin-bottom: 3px;">éƒ¨å“
                                å€¤å¼•ç‡(%)</label>
                            <input type="number" class="form-control" id="globalDiscountParts" value="0" min="0"
                                max="100" oninput="updateGlobalDiscount('parts', this.value)" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.85em; color: #666; margin-bottom: 3px;">é‰±æ²¹é¡
                                å€¤å¼•ç‡(%)</label>
                            <input type="number" class="form-control" id="globalDiscountFluid" value="0" min="0"
                                max="100" oninput="updateGlobalDiscount('fluid', this.value)" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.85em; color: #666; margin-bottom: 3px;">å·¥è³ƒ
                                å€¤å¼•ç‡(%)</label>
                            <input type="number" class="form-control" id="globalDiscountWage" value="0" min="0"
                                max="100" oninput="updateGlobalDiscount('wage', this.value)" style="width: 100%;">
                        </div>
                    </div>
                    <div style="font-size: 0.75em; color: #666; margin-top: 6px;">â€» å…¨ã¦ã®æ•´å‚™é …ç›®ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚å„é …ç›®ã”ã¨ã®å€¤å¼•ãã¨åˆç®—ã•ã‚Œã¾ã™ã€‚
                    </div>
                </div>

                <button type="button" class="btn btn-outline quick-add-btn" onclick="showQuickAddModal()">ğŸ“‹
                    ã‚ˆãä½¿ã†é …ç›®ã‹ã‚‰é¸æŠ</button>
            </div>
        </div>

        <!-- æ³•å®šè²»ç”¨ -->
        <div class="card">
            <div class="card-header">ğŸ“‹ æ³•å®šè²»ç”¨ãƒ»è«¸è²»ç”¨</div>
            <div class="card-body">
                <table class="legal-table">
                    <tr>
                        <td>è‡ªå‹•è»Šé‡é‡ç¨ï¼ˆ1å¹´ï¼‰</td>
                        <td class="text-right">
                            <input type="number" class="form-control fee-input" id="weightTaxInput" value="0"
                                onchange="onManualLegalFeeChange()">
                        </td>
                    </tr>
                    <tr>
                        <td>è‡ªè³ è²¬ä¿é™ºæ–™ï¼ˆ24ãƒ¶æœˆï¼‰</td>
                        <td class="text-right">
                            <input type="number" class="form-control fee-input" id="jibaisekiInput" value="0"
                                onchange="onManualLegalFeeChange()">
                        </td>
                    </tr>
                    <tr>
                        <td>å°ç´™ä»£</td>
                        <td class="text-right">
                            <input type="number" class="form-control fee-input" id="stampInput" value="0"
                                onchange="onManualLegalFeeChange()">
                        </td>
                    </tr>
                    <tr>
                        <td>æ¤œæŸ»äºˆç´„æ‰‹æ•°æ–™</td>
                        <td class="text-right">
                            <input type="number" class="form-control fee-input" id="reservationFee" value="2200"
                                onchange="calculateTotals()">
                        </td>
                    </tr>
                    <tr>
                        <td>ä»£è¡Œæ‰‹æ•°æ–™</td>
                        <td class="text-right">
                            <input type="number" class="form-control fee-input" id="agencyFee" value="11000"
                                onchange="calculateTotals()">
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- åˆè¨ˆé‡‘é¡ -->
        <div class="card summary-card">
            <div class="card-header">ğŸ’° åˆè¨ˆé‡‘é¡</div>
            <div class="card-body">
                <div class="summary-row">
                    <span>æ•´å‚™è²»ç”¨ å°è¨ˆï¼ˆç¨è¾¼ï¼‰</span>
                    <span id="maintenanceSubtotal">Â¥0</span>
                </div>
                <div class="summary-row">
                    <span>æ³•å®šè²»ç”¨ãƒ»è«¸è²»ç”¨ å°è¨ˆ</span>
                    <span id="legalFeesSubtotal">Â¥0</span>
                </div>
                <div class="summary-row total">
                    <span>ãŠæ”¯æ‰•ã„ç·é¡</span>
                    <span id="grandTotal">Â¥0</span>
                </div>
            </div>
        </div>

        <!-- å‚™è€ƒ -->
        <div class="card">
            <div class="card-header">ğŸ“ å‚™è€ƒãƒ»ãƒ¡ãƒ¢</div>
            <div class="card-body">
                <div class="form-group">
                    <label>è¦‹ç©æ›¸å‚™è€ƒï¼ˆè¦‹ç©æ›¸ã«å°åˆ·ã•ã‚Œã¾ã™ï¼‰</label>
                    <textarea class="form-control" id="notes" rows="3"
                        placeholder="è¿½åŠ ã®æ•´å‚™ãŒå¿…è¦ãªå ´åˆã¯åˆ¥é€”ãŠè¦‹ç©ã‚Šã„ãŸã—ã¾ã™ã€‚"></textarea>
                </div>
                <div class="form-group" style="margin-top:15px;border-top:1px dashed #eee;padding-top:15px;">
                    <label>ğŸ’¬ ãŠå®¢æ§˜ãƒ¡ãƒ¢ï¼ˆç¤¾å†…ç”¨ãƒ»å°åˆ·ã•ã‚Œã¾ã›ã‚“ï¼‰</label>
                    <textarea class="form-control" id="customerMemo" rows="2"
                        placeholder="ãŠå®¢æ§˜ã®å¥½ã¿ã€æ¬¡å›ã®ææ¡ˆäº‹é …ãªã©..."></textarea>
                </div>

                <!-- å†™çœŸæ·»ä»˜ (ã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½) -->
                <div class="form-group" style="margin-top:15px;border-top:1px dashed #eee;padding-top:15px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">ğŸ“· è»Šä¸¡ãƒ»éƒ¨å“ã®å†™çœŸæ·»ä»˜ (ã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="file" id="vehiclePhotoUpload" accept="image/*" class="form-control"
                            style="width: auto;">
                        <button type="button" class="btn btn-secondary" onclick="uploadSelectedPhoto()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div id="uploadedPhotosList" style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒè¨­å®š -->
    <div class="modal-overlay" id="themeSettingsModal">
        <div class="modal-content" style="max-width:500px;">
            <div class="modal-header">
                <h2>ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š</h2>
                <button class="modal-close" onclick="closeThemeSettingsModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</label>
                    <div class="theme-colors" style="display:flex;gap:10px;margin-top:8px;">
                        <div class="theme-color-btn active" style="background:#1a5a8a;"
                            onclick="setThemeColor('#1a5a8a', this)">æ¨™æº–</div>
                        <div class="theme-color-btn" style="background:#2c3e50;"
                            onclick="setThemeColor('#2c3e50', this)">ãƒ€ãƒ¼ã‚¯</div>
                        <div class="theme-color-btn" style="background:#c0392b;"
                            onclick="setThemeColor('#c0392b', this)">ãƒ¬ãƒƒãƒ‰</div>
                        <div class="theme-color-btn" style="background:#27ae60;"
                            onclick="setThemeColor('#27ae60', this)">ã‚°ãƒªãƒ¼ãƒ³</div>
                        <div class="theme-color-btn" style="background:#8e44ad;"
                            onclick="setThemeColor('#8e44ad', this)">ãƒ‘ãƒ¼ãƒ—ãƒ«</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¼šç¤¾ãƒ­ã‚´ç”»åƒ</label>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <input type="file" id="companyLogoInput" accept="image/*" style="display:none"
                            onchange="handleLogoUpload(this)">
                        <button class="btn btn-outline btn-sm"
                            onclick="document.getElementById('companyLogoInput').click()">ğŸ“· ç”»åƒã‚’é¸æŠ</button>
                        <button class="btn btn-outline btn-sm" onclick="clearCompanyLogo()"
                            style="color:#e74c3c;border-color:#e74c3c;">å‰Šé™¤</button>
                    </div>
                    <div id="companyLogoPreview"
                        style="margin-top:10px;max-width:200px;border:1px dashed #ddd;padding:5px;display:none;">
                        <img src="" style="width:100%;height:auto;">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveThemeSettings()">ä¿å­˜ã—ã¦é©ç”¨</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: æ•´å‚™é …ç›®é¸æŠ -->
    <div class="modal-overlay" id="quickAddModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‹ æ•´å‚™é …ç›®ã‚’é¸æŠ</h2>
                <button class="modal-close" onclick="closeQuickAddModal()">Ã—</button>
            </div>
            <button class="modal-close-absolute" onclick="closeQuickAddModal()" style="display: block;">Ã—</button>
            <div class="modal-body">
                <div class="category-tabs" id="categoryTabs"></div>
                <div class="quick-items-list" id="quickItemsList"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: é¡§å®¢ãƒªã‚¹ãƒˆ -->
    <div class="modal-overlay" id="customerListModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‚ ä¿å­˜æ¸ˆã¿ãŠå®¢æ§˜ãƒ‡ãƒ¼ã‚¿</h2>
                <button class="modal-close" onclick="closeCustomerListModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="text" class="form-control" id="customerSearch" placeholder="ğŸ” åå‰ãƒ»ãƒŠãƒ³ãƒãƒ¼ãƒ»è»Šåã§æ¤œç´¢..."
                    oninput="searchCustomers()">
                <div class="customer-list" id="customerListItems"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal-content preview-modal">
            <div class="modal-header">
                <h2>ğŸ“„ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                <button class="modal-close" onclick="closePreviewModal()">Ã—</button>
            </div>
            <div class="modal-body" id="previewContent"></div>
            <div class="modal-footer" style="justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <label for="printModeSelect" style="font-weight: bold; font-size: 0.9em;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š:</label>
                    <select id="printModeSelect" class="form-control" style="width: auto; padding: 4px 8px;"
                        onchange="setPrintMode(this.value)">
                        <option value="auto" selected>è‡ªå‹• (æ¨å¥¨)</option>
                        <option value="standard">æ¨™æº–</option>
                        <option value="compact">ã‚„ã‚„è©°ã‚ã‚‹ (90%)</option>
                        <option value="eco">ã‹ãªã‚Šè©°ã‚ã‚‹ (80%)</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outline" onclick="closePreviewModal()">é–‰ã˜ã‚‹</button>
                    <button class="btn btn-primary" onclick="shareToLine()" style="background:#06C755;">ğŸ“±
                        LINEã§å…±æœ‰</button>
                    <button class="btn btn-success" onclick="generatePDF()">ğŸ“„ PDFå‡ºåŠ›</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ -->
    <div class="modal-overlay" id="qrScannerModal">
        <div class="modal-content" style="max-width:500px;">
            <div class="modal-header">
                <h2>ğŸ“· è»Šæ¤œè¨¼QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</h2>
                <button class="modal-close" onclick="closeQRScannerModal()">Ã—</button>
            </div>
            <div class="modal-body" style="text-align:center;">
                <div
                    style="position:relative;width:100%;max-width:400px;margin:0 auto;background:#000;border-radius:8px;overflow:hidden;">
                    <video id="qrVideo" style="width:100%;height:300px;object-fit:cover;" playsinline></video>
                    <div
                        style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:200px;border:3px solid #4CAF50;border-radius:12px;box-shadow:0 0 0 9999px rgba(0,0,0,0.5);">
                    </div>
                </div>
                <p id="qrStatus" style="margin-top:16px;color:#666;">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...</p>
                <p style="font-size:0.85em;color:#999;margin-top:8px;">ğŸ’¡ è»Šæ¤œè¨¼ã®QRã‚³ãƒ¼ãƒ‰ã‚’æ å†…ã«åˆã‚ã›ã¦ãã ã•ã„</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeQRScannerModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: è»Šæ¤œæœŸé™ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ -->
    <div class="modal-overlay" id="reminderModal">
        <div class="modal-content" style="max-width:700px;">
            <div class="modal-header">
                <h2>ğŸ”” è»Šæ¤œæœŸé™ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</h2>
                <button class="modal-close" onclick="closeReminderModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:12px;color:#666;">ä¿å­˜ã•ã‚ŒãŸé¡§å®¢ã®è»Šæ¤œæº€äº†æ—¥ã‚’æœŸé™é †ã«è¡¨ç¤ºã—ã¾ã™</p>
                <div class="reminder-list" id="reminderListItems" style="max-height:400px;overflow-y:auto;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeReminderModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: è¦‹ç©å±¥æ­´ -->
    <div class="modal-overlay" id="estimateHistoryModal">
        <div class="modal-content" style="max-width:800px;">
            <div class="modal-header">
                <h2>ğŸ“Š è¦‹ç©å±¥æ­´</h2>
                <button class="modal-close" onclick="closeEstimateHistoryModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="history-actions" style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
                    <input type="text" class="form-control" id="estimateHistorySearch"
                        placeholder="ğŸ” åå‰ãƒ»ãƒŠãƒ³ãƒãƒ¼ãƒ»è»Šåãƒ»é‡‘é¡ã§æ¤œç´¢..." oninput="searchEstimateHistory()"
                        style="flex:1;min-width:200px;">
                    <button class="btn btn-success" onclick="saveEstimateToHistory()">ğŸ’¾ ç¾åœ¨ã®è¦‹ç©ã‚’ä¿å­˜</button>
                    <button class="btn btn-outline" onclick="saveAsTemplate()">ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä¿å­˜</button>
                </div>
                <div class="estimate-history-list" id="estimateHistoryItems" style="max-height:400px;overflow-y:auto;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeEstimateHistoryModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal-content" style="max-width:600px;">
            <div class="modal-header">
                <h2>ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§</h2>
                <button class="modal-close" onclick="closeTemplateModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:12px;color:#666;">ã‚ˆãä½¿ã†æ•´å‚™é …ç›®ã‚»ãƒƒãƒˆã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä¿å­˜ãƒ»é©ç”¨ã§ãã¾ã™</p>
                <div class="template-list" id="templateListItems" style="max-height:400px;overflow-y:auto;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeTemplateModal()">é–‰ã˜ã‚‹</button>
                <button class="btn btn-success" onclick="saveAsTemplate()">ğŸ’¾ ç¾åœ¨ã®æ•´å‚™é …ç›®ã‚’ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: QRã‚³ãƒ¼ãƒ‰ -->
    <div class="modal-overlay" id="qrCodeModal">
        <div class="modal-content" style="max-width:400px;text-align:center;">
            <div class="modal-header">
                <h2>ğŸ“± QRã‚³ãƒ¼ãƒ‰</h2>
                <button class="modal-close" onclick="closeQRCodeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;color:#666;">ãŠå®¢æ§˜ã®ã‚¹ãƒãƒ›ã§èª­ã¿å–ã‚‹ã¨è¦‹ç©å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™</p>
                <div id="qrCodeDisplay"
                    style="display:inline-block;padding:16px;background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <pre id="qrCodeText"
                    style="margin-top:16px;padding:12px;background:#f5f5f5;border-radius:8px;text-align:left;white-space:pre-wrap;font-size:0.85em;"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeQRCodeModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: LINEå…±æœ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="modal-overlay" id="lineShareModal">
        <div class="modal-content" style="max-width:500px;">
            <div class="modal-header">
                <h2>ğŸ“± LINEã§å…±æœ‰</h2>
                <button class="modal-close" onclick="closeLineShareModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:12px;color:#666;">ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦LINEã«è²¼ã‚Šã‘ã‚‹ã‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ç›´æ¥å…±æœ‰ã—ã¦ãã ã•ã„ã€‚</p>
                <textarea class="form-control" id="lineShareText" rows="10" style="font-size:0.9em;margin-bottom:16px;"
                    readonly></textarea>
                <div style="display:flex;gap:10px;justify-content:center;">
                    <button class="btn btn-primary" onclick="copyLineText()" style="flex:1;">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    <button class="btn btn-success" onclick="openLineApp()" style="flex:1;background:#06C755;">ğŸ“±
                        LINEã‚’é–‹ã</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeLineShareModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- JSON ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="jsonImportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¥ è»Šæ¤œè¨¼JSONèª­ã¿è¾¼ã¿</h3>
                <button class="modal-close" onclick="closeJsonImportModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;color:#666;font-size:0.9em;">
                    ğŸ“± iPhoneã¾ãŸã¯Androidã®ã€Œè»Šæ¤œè¨¼é–²è¦§ã‚¢ãƒ—ãƒªã€ã§ICã‚¿ã‚°ã‚’èª­ã¿å–ã‚Šã€<br>
                    JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€ã“ã“ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚
                </p>
                <div style="border:2px dashed #ccc;border-radius:8px;padding:24px;text-align:center;margin-bottom:16px;"
                    id="jsonDropZone">
                    <p style="color:#666;margin-bottom:12px;">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    <p style="color:#999;font-size:0.85em;margin-bottom:12px;">ã¾ãŸã¯</p>
                    <label class="btn btn-primary" style="cursor:pointer;">
                        ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                        <input type="file" id="jsonFileInput" accept=".json,application/json" style="display:none;"
                            onchange="handleJsonFileSelect(event)">
                    </label>
                </div>
                <div id="jsonImportResult"
                    style="display:none;padding:12px;background:#e8f5e9;border-radius:8px;margin-top:12px;">
                    <p style="color:#2e7d32;font-weight:600;">âœ… èª­ã¿è¾¼ã¿æˆåŠŸï¼</p>
                    <pre id="jsonImportPreview" style="margin-top:8px;font-size:0.85em;white-space:pre-wrap;"></pre>
                </div>
                <div id="jsonImportError"
                    style="display:none;padding:12px;background:#ffebee;border-radius:8px;margin-top:12px;">
                    <p style="color:#c62828;font-weight:600;">âŒ ã‚¨ãƒ©ãƒ¼</p>
                    <p id="jsonImportErrorText" style="color:#c62828;font-size:0.9em;"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeJsonImportModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cardb.js"></script>
    <script src="js/main.js"></script>
    <script src="js/wareki.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="js/upload_client.js"></script>
    <script src="js/pdf.js"></script>
</body>

</html>< ! - -   r e l o a d   t r i g g e r   - - > 
     
     