# 要件定義書 - Mechaniq（メカニーク）

## プロジェクト概要

### システム名

**Mechaniq（メカニーク）** - 車検見積管理システム

### システム概要

自動車整備工場向けの車検見積書作成・管理システム。顧客情報、車両情報、整備項目を入力し、法定費用を自動計算して見積書を生成する。

### 開発背景・目的

- 自動車整備工場における車検見積作成業務の効率化
- 正確な法定費用の自動計算による見積精度の向上
- 顧客・車両データの一元管理
- ペーパーレス化とデジタル化の推進

---

## ビジネス要件

### 対象ユーザー

| ユーザー種別 | 説明 |
|-------------|------|
| 整備士・フロントスタッフ | 日常的に見積作成を行う主要ユーザー |
| 工場管理者 | ユーザー管理、データ管理を行う |

### 業務フロー

```
1. ログイン
   ↓
2. 顧客情報入力/読み込み
   ↓
3. 車両情報入力（QRコード/JSON読み込み対応）
   ↓
4. 整備項目選択・追加
   ↓
5. 法定費用自動計算
   ↓
6. プレビュー確認
   ↓
7. PDF出力/LINE共有/データ保存
```

### 主要成果物

- 見積書（PDF形式）
- 請求書（PDF形式）
- 領収書（PDF形式）

---

## 機能要件

### 1. 認証・セキュリティ

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| AUTH-01 | ユーザーログイン | 必須 | ユーザー名/パスワードによる認証 |
| AUTH-02 | 2要素認証 | 任意 | TOTP（Google Authenticator等）対応 |
| AUTH-03 | パスワードリセット | 必須 | メールによるパスワード再設定 |
| AUTH-04 | セッション管理 | 必須 | JWTトークン（8時間有効） |

### 2. 顧客管理

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| CUST-01 | 顧客情報登録 | 必須 | 使用者・所有者情報の登録 |
| CUST-02 | 顧客検索 | 必須 | 名前、ナンバー、車名による検索 |
| CUST-03 | 顧客情報編集 | 必須 | 登録済み顧客情報の更新 |
| CUST-04 | 顧客情報削除 | 必須 | 顧客データの削除 |
| CUST-05 | データエクスポート | 任意 | JSON形式でのエクスポート |
| CUST-06 | データインポート | 任意 | JSON形式でのインポート |

### 3. 車両情報管理

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| VEH-01 | 車両情報入力 | 必須 | ナンバー、車名、型式、車台番号等 |
| VEH-02 | QRコード読み取り | 任意 | 車検証QRコードからの自動入力 |
| VEH-03 | 電子車検証JSON | 任意 | 電子車検証アプリからのデータ読込 |
| VEH-04 | メーカー・車名DB | 必須 | 国内主要メーカーの車名・型式データ |

### 4. 見積作成

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| EST-01 | 整備項目選択 | 必須 | カテゴリ別整備項目の選択 |
| EST-02 | 項目カスタム追加 | 必須 | 任意の整備項目追加 |
| EST-03 | 法定費用自動計算 | 必須 | 重量税、自賠責、印紙代の自動計算 |
| EST-04 | 値引き適用 | 任意 | 部品、鉱油類、工賃への値引き率設定 |
| EST-05 | 消費税計算 | 必須 | 税率10%での自動計算 |

### 5. 出力・共有

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| OUT-01 | 印刷プレビュー | 必須 | A4形式でのプレビュー表示 |
| OUT-02 | PDF出力 | 必須 | 見積書/請求書/領収書のPDF生成 |
| OUT-03 | LINE共有 | 任意 | LINEアプリへの見積情報共有 |
| OUT-04 | QRコード生成 | 任意 | 見積情報のQRコード表示 |

### 6. データ管理

| 要件ID | 要件名 | 優先度 | 説明 |
|--------|--------|--------|------|
| DATA-01 | 見積履歴保存 | 必須 | 作成した見積の履歴管理 |
| DATA-02 | テンプレート機能 | 任意 | よく使う整備項目セットの保存 |
| DATA-03 | 写真添付 | 任意 | 車両・部品の写真アップロード |

---

## 非機能要件

### パフォーマンス要件

| 要件ID | 要件 | 基準値 |
|--------|------|--------|
| PERF-01 | ページ読み込み時間 | 3秒以内 |
| PERF-02 | API応答時間 | 1秒以内 |
| PERF-03 | PDF生成時間 | 5秒以内 |

### 可用性要件

| 要件ID | 要件 | 基準値 |
|--------|------|--------|
| AVAIL-01 | 稼働時間 | 営業時間中(8:00-20:00) |
| AVAIL-02 | 同時接続数 | 10ユーザー |

### セキュリティ要件

| 要件ID | 要件 | 説明 |
|--------|------|------|
| SEC-01 | HTTPS通信 | 本番環境ではHTTPSを使用 |
| SEC-02 | パスワードハッシュ化 | bcryptによる暗号化 |
| SEC-03 | アクセス制限 | Rate Limiting適用 |
| SEC-04 | セキュリティヘッダー | Helmet.jsによる保護 |

### 互換性要件

| 要件ID | 対象 | バージョン |
|--------|------|-----------|
| COMP-01 | ブラウザ | Chrome, Edge, Safari（最新版） |
| COMP-02 | Node.js | 18.x以上 |
| COMP-03 | データベース | SQLite 3.x（開発）/ PostgreSQL（本番） |

---

## 制約条件

### 技術的制約

- ローカル環境（デスクトップ）での動作を主目的とする
- file://プロトコルでの動作をサポート
- インターネット接続がなくても基本機能は動作すること

### 運用的制約

- 導入時の初期設定はユーザー自身で行う
- バックアップはユーザー責任で実施

---

## 用語定義

| 用語 | 説明 |
|------|------|
| 車検 | 自動車検査。道路運送車両法に基づく定期検査 |
| 法定費用 | 重量税、自賠責保険料、印紙代の合計 |
| OSS | ワンストップサービス。電子申請による手続き |
| 使用者 | 車検証に記載される車両の使用者 |
| 所有者 | 車検証に記載される車両の所有者（ローン会社等） |
| 2要素認証(2FA) | パスワード+ワンタイムパスワードによる認証 |

---

## 更新履歴

| バージョン | 日付 | 更新者 | 内容 |
|-----------|------|--------|------|
| 1.0 | 2026-02-03 | - | 初版作成 |
