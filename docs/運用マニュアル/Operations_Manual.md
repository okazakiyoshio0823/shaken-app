# 運用マニュアル - Mechaniq（メカニーク）

## はじめに

本マニュアルでは、Mechaniq（メカニーク）車検見積管理システムの導入、起動、運用方法について説明します。

---

## システム要件

### ハードウェア要件

| 項目 | 最小要件 | 推奨要件 |
|------|---------|---------|
| CPU | デュアルコア以上 | クアッドコア以上 |
| メモリ | 4GB以上 | 8GB以上 |
| ストレージ | 500MB以上 | 1GB以上 |

### ソフトウェア要件

| ソフトウェア | バージョン |
|-------------|-----------|
| Node.js | 18.x以上 |
| npm | 9.x以上 |
| ブラウザ | Chrome/Edge/Safari 最新版 |

---

## インストール手順

### 1. Node.jsのインストール

1. [Node.js公式サイト](https://nodejs.org/)にアクセス
2. LTS版をダウンロード
3. インストーラーを実行

### 2. プロジェクトのセットアップ

```bash
# サーバーディレクトリに移動
cd shaken_app/server

# 依存パッケージのインストール
npm install
```

### 3. 初期設定（任意）

環境変数ファイルを作成:

```bash
# server/.envファイルを作成
echo "PORT=5000" > .env
echo "JWT_SECRET=your_secret_key" >> .env
```

---

## 起動方法

### 方法1: コマンドラインから起動

```bash
cd shaken_app/server
npm start
```

### 方法2: バッチファイルから起動（Windows）

```
shaken_app/start_app.bat をダブルクリック
```

### 方法3: 開発モード（ホットリロード有効）

```bash
cd shaken_app/server
npm run dev
```

### 起動確認

1. サーバー起動後、ブラウザで以下にアクセス:

   ```
   file:///C:/path/to/shaken_app/index.html
   ```

   または

   ```
   http://localhost:5000/index.html（サーバーから配信する場合）
   ```

2. コンソールに以下が表示されれば成功:

   ```
   Database synced
   Server is running on port 5000
   ```

---

## 初期ユーザー設定

### 管理者ユーザーの作成

1. `login.html`にアクセス
2. 画面下部の「adminを作成」リンクをクリック
3. 確認ダイアログで「OK」を選択
4. 以下の初期ユーザーが作成されます:
   - ユーザー名: `admin`
   - パスワード: `admin`

### パスワード変更（推奨）

1. ログイン後、画面右上の「パスワード変更」から実施
2. 強固なパスワードに変更してください

---

## 日常運用

### 見積作成の流れ

1. ログイン
2. 会社情報を確認・編集（初回のみ）
3. お客様情報を入力（または保存済みから読み込み）
4. 車両情報を入力
   - 手動入力
   - QRコードスキャン
   - 車検証JSONインポート
5. 整備項目を選択・追加
6. 法定費用を確認
7. プレビューで確認
8. PDF出力または保存

### データの保存

- 「このお客様を保存」ボタンで顧客・車両・見積情報を保存
- サーバー接続時はデータベースに保存
- オフライン時はブラウザのローカルストレージに保存

### データのバックアップ

- 「ファイルへエクスポート」でJSON形式でバックアップ可能
- 定期的なバックアップを推奨

---

## トラブルシューティング

### サーバーが起動しない

**症状:** `npm start` でエラーが発生

**対処法:**

1. Node.jsがインストールされているか確認

   ```bash
   node -v
   ```

2. 依存パッケージを再インストール

   ```bash
   cd server
   rm -rf node_modules
   npm install
   ```

3. ポート5000が使用中でないか確認

---

### ログインできない

**症状:** 「Invalid credentials」エラー

**対処法:**

1. ユーザー名・パスワードを確認
2. 初期ユーザーが作成されているか確認
3. サーバーが起動しているか確認
   - ブラウザのコンソールでネットワークエラーをチェック

---

### データが保存されない

**症状:** 保存ボタンを押してもデータが消える

**対処法:**

1. サーバーが起動しているか確認
2. ブラウザのコンソールでエラーを確認
3. データベースファイルの権限を確認

   ```
   server/database.sqlite
   ```

---

### PDF出力が動作しない

**症状:** PDF出力ボタンを押しても何も起きない

**対処法:**

1. ブラウザのポップアップブロッカーを確認
2. html2pdf.jsが読み込まれているか確認
   - ブラウザのコンソールでエラーチェック
3. インターネット接続を確認（CDNからライブラリを読み込むため）

---

### QRコードが読み取れない

**症状:** カメラが起動しない/QRが認識されない

**対処法:**

1. ブラウザのカメラ権限を許可
2. HTTPSまたはlocalhostでアクセス（カメラはセキュアコンテキスト必須）
3. 十分な明るさでQRコードを表示
4. QRコードを画面の枠内に収める

---

## データ管理

### データベースの場所

```
shaken_app/server/database.sqlite
```

### バックアップ方法

```bash
# データベースファイルをコピー
cp server/database.sqlite server/backup/database_$(date +%Y%m%d).sqlite
```

### データリセット

⚠️ **注意: すべてのデータが削除されます**

```bash
# データベースファイルを削除
rm server/database.sqlite

# サーバーを再起動すると新規DBが作成される
npm start
```

---

## セキュリティ運用

### 定期的な確認事項

- [ ] 不審なログイン履歴の確認
- [ ] パスワードの定期変更
- [ ] バックアップの実施

### 推奨セキュリティ設定

1. 強固なパスワードの使用
2. 2要素認証の有効化
3. 定期的なデータバックアップ

---

## アップデート

### 手順

1. 現在のデータをバックアップ
2. 新しいバージョンのファイルを配置
3. 依存パッケージを更新

   ```bash
   cd server
   npm install
   ```

4. サーバーを再起動

---

## サポート

### ログの確認

- ブラウザ: 開発者ツール（F12）→ Console
- サーバー: 起動しているターミナルに出力

### よくある質問

**Q: オフラインでも使えますか？**
A: 基本的な見積作成は可能ですが、データ保存はサーバー起動が必要です。

**Q: スマートフォンで使えますか？**
A: ブラウザからアクセス可能ですが、デスクトップ表示での利用を推奨します。

**Q: 複数人で同時に使えますか？**
A: はい、サーバーを共有すれば複数ユーザーで利用可能です。

---

## 付録

### コマンド一覧

| コマンド | 用途 |
|---------|------|
| `npm start` | サーバー起動 |
| `npm run dev` | 開発モード起動 |
| `npm install` | 依存パッケージインストール |

### ファイル構成（重要ファイル）

| ファイル | 説明 |
|---------|------|
| index.html | メインアプリケーション |
| login.html | ログイン画面 |
| server/src/app.js | サーバーエントリーポイント |
| server/database.sqlite | データベース |
| server/package.json | サーバー依存関係 |

---

## 更新履歴

| バージョン | 日付 | 更新者 | 内容 |
|-----------|------|--------|------|
| 1.0 | 2026-02-03 | - | 初版作成 |
